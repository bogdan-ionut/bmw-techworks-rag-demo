<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>BMW TechWorks ‚Ä¢ Live Architecture</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet" />
  <style>
    /* --- DESIGN SYSTEM --- */
    :root {
      --bg-primary: #f8fafc;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --accent-primary: #2563eb;
      --accent-glow: rgba(37, 99, 235, 0.12);
      --border-subtle: #cbd5e1;
      --shadow-soft: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
      --shadow-hover: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --font-sans: "Inter", sans-serif;
      --font-mono: "JetBrains Mono", monospace;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    html { zoom: 75%; }

    body {
      font-family: var(--font-sans);
      background: var(--bg-primary);
      background-image:
        linear-gradient(rgba(37, 99, 235, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(37, 99, 235, 0.03) 1px, transparent 1px);
      background-size: 40px 40px;
      color: var(--text-primary);
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* --- HEADER --- */
    header {
      height: 60px;
      flex-shrink: 0;
      background: rgba(255, 255, 255, 0.85);
      border-bottom: 1px solid var(--border-subtle);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 24px;
      z-index: 1000;
      backdrop-filter: blur(12px);
    }

    .brand {
        font-size: 18px; font-weight: 800; color: #1e40af; text-decoration: none;
        display: flex; align-items: center; gap: 10px;
    }

    .nav { display: flex; gap: 12px; }
    .nav a {
        text-decoration: none; color: var(--text-secondary); font-size: 13px; font-weight: 600;
        padding: 8px 16px; border-radius: 8px; transition: all 0.2s;
        display: flex; align-items: center; gap: 6px;
    }
    .nav a:hover { background: #eff6ff; color: var(--accent-primary); }
    .nav a.active { background: #eff6ff; color: var(--accent-primary); }

    .status-badge {
        display: flex; align-items: center; gap: 8px;
        background: white; border: 1px solid #e2e8f0;
        padding: 6px 12px; border-radius: 20px;
        font-size: 11px; font-weight: 600; color: #64748b;
    }
    .status-dot {
        width: 8px; height: 8px; background: #22c55e; border-radius: 50%;
        box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.2);
        animation: pulse-green 2s infinite;
    }
    @keyframes pulse-green { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

    /* --- CANVAS CONTAINER --- */
    .viewport {
      flex: 1;
      width: 100%;
      height: 100%;
      overflow: hidden;
      position: relative;
      cursor: grab;
    }
    .viewport:active { cursor: grabbing; }

    /* --- WRAPPER FOR SCALING --- */
    .scalable-wrapper {
        position: absolute;
        top: 50%;
        left: 50%;
        /* Logical dimensions */
        width: 1800px;
        height: 1000px;
        transform-origin: center center;
        /* No transition on transform to ensure instant drag response */
    }

    /* SVG LAYER */
    .connections-layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
    }

    .connection-line {
      fill: none;
      stroke: #cbd5e1;
      stroke-width: 2px;
    }

    .connection-dashed {
        stroke-dasharray: 6, 6;
        stroke: #94a3b8;
        opacity: 0.4;
    }

    .packet {
      fill: var(--accent-primary);
      filter: drop-shadow(0 0 4px var(--accent-primary));
    }

    /* --- GRID LAYOUT --- */
    .arch-grid {
      display: grid;
      width: 100%;
      height: 100%;
      padding: 60px;
      /* Cols: [Data] [User/CI] [ALB/ECR] [ECS] [Secrets/S3] [AI Stack] */
      grid-template-columns: 240px 240px 240px 340px 220px 280px;
      grid-template-rows: auto auto auto auto;
      gap: 30px 50px;
      position: relative;
      z-index: 2;
    }

    /* --- NODES --- */
    .node {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(8px);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      padding: 18px;
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 10px;
      position: relative;
      transition: box-shadow 0.3s ease, border-color 0.3s ease;
      min-height: 110px;
      min-width: 0;
      user-select: none;
    }

    .node:hover {
        transform: translateY(-2px);
        border-color: var(--accent-primary);
        box-shadow: var(--shadow-hover);
        z-index: 10;
    }

    .pulse { animation: pulse-glow 4s infinite ease-in-out; }
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 0 0 rgba(37,99,235,0); border-color: var(--border-subtle); }
      50% { box-shadow: 0 0 25px var(--accent-glow); border-color: #60a5fa; }
    }

    .node-header { display: flex; align-items: center; gap: 12px; margin-bottom: 2px; }
    .node-icon {
      width: 38px; height: 38px; flex-shrink: 0;
      background: linear-gradient(135deg, #f8fafc, #f1f5f9);
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px; color: var(--text-secondary);
    }
    .node-titles { min-width: 0; flex: 1; }
    .node-title { font-size: 14px; font-weight: 700; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .node-sub { font-size: 10px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.8px; }

    .node-details {
        font-size: 11px;
        color: #64748b;
        line-height: 1.5;
        margin-bottom: 6px;
        white-space: normal;
        overflow-wrap: break-word;
    }

    .tech-stack {
      margin-top: auto;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .tech-tag {
      font-size: 10px; font-family: var(--font-mono); color: #334155;
      background: #f1f5f9; border: 1px solid #e2e8f0;
      padding: 3px 8px; border-radius: 6px;
      white-space: nowrap;
    }

    /* --- SPECIAL STYLES --- */
    #n-ecs {
        border: 2px solid var(--accent-primary);
        background: #ffffff;
        align-self: center;
        justify-content: center;
        box-shadow: 0 10px 30px -5px rgba(37, 99, 235, 0.15);
    }

    .group-label {
        position: absolute;
        top: -28px; left: 0;
        font-size: 10px; font-weight: 700; letter-spacing: 1.2px; color: #94a3b8;
        text-transform: uppercase;
        width: 100%;
        display: flex; align-items: center; gap: 8px;
    }
    .group-label::after {
        content: ''; height: 1px; flex: 1; background: #e2e8f0;
    }

    /* --- POSITIONING --- */

    /* Col 1: Data Pipeline */
    #n-ingestion   { grid-column: 1; grid-row: 1; margin-top: 30px; }
    #n-norm        { grid-column: 1; grid-row: 2; }
    #n-enrichment  { grid-column: 1; grid-row: 3; margin-bottom: 30px; }

    /* Col 2: User & CI/CD */
    #n-user        { grid-column: 2; grid-row: 1; align-self: start; margin-top: 30px; }
    #n-github      { grid-column: 2; grid-row: 3; align-self: end; margin-bottom: 30px; margin-top: 60px; }

    /* Col 3: ALB & ECR */
    #n-alb         { grid-column: 3; grid-row: 1; align-self: start; margin-top: 30px; }
    #n-ecr         { grid-column: 3; grid-row: 3; align-self: end; margin-bottom: 30px; margin-top: 60px; }

    /* Col 4: Core Compute */
    #n-ecs         { grid-column: 4; grid-row: 1; grid-row-end: 4; }

    /* Col 5: Dependencies */
    #n-secrets     { grid-column: 5; grid-row: 2; align-self: start; margin-top: -30px; }
    #n-s3          { grid-column: 5; grid-row: 3; align-self: end; margin-bottom: 60px; }

    /* Col 6: AI Services */
    .ai-stack {
        grid-column: 6; grid-row: 1; grid-row-end: 5;
        display: flex; flex-direction: column; justify-content: center; gap: 35px;
    }

    /* --- ZOOM CONTROLS --- */
    .zoom-controls {
        position: fixed;
        bottom: 30px;
        right: 30px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        z-index: 100;
        background: white;
        padding: 8px;
        border-radius: 12px;
        box-shadow: var(--shadow-hover);
        border: 1px solid var(--border-subtle);
    }

    .zoom-btn {
        width: 40px;
        height: 40px;
        border: none;
        background: #f8fafc;
        border-radius: 8px;
        color: var(--text-primary);
        font-size: 20px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        display: flex; align-items: center; justify-content: center;
    }
    .zoom-btn:hover { background: #e2e8f0; color: var(--accent-primary); }
    .zoom-btn:active { transform: scale(0.95); }

  </style>
</head>
<body>

  <header>
    <a href="/" class="brand">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
        BMW TechWorks
    </a>
    <div class="status-badge">
        <div class="status-dot"></div>
        SYSTEM ONLINE
    </div>
    <nav class="nav">
      <a href="/">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        Search Demo
      </a>
      <a href="#" class="active">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"/><rect x="2" y="14" width="20" height="8" rx="2" ry="2"/><line x1="6" y1="6" x2="6" y2="6"/><line x1="6" y1="18" x2="6" y2="18"/></svg>
        Live Architecture
      </a>
    </nav>
  </header>

  <div class="viewport" id="viewport">
    <div class="scalable-wrapper" id="wrapper">

        <svg class="connections-layer" id="svgLayer">
            <defs>
                <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto"><path d="M0,0 L0,6 L9,3 z" fill="#cbd5e1" /></marker>
            </defs>
        </svg>

        <div class="arch-grid" id="grid">

            <div class="node" id="n-ingestion">
                <div class="group-label">Data Pipeline (Offline)</div>
                <div class="node-header">
                    <div class="node-icon">üï∑Ô∏è</div>
                    <div class="node-titles"><div class="node-title">Acquisition</div><div class="node-sub">PhantomBuster</div></div>
                </div>
                <div class="node-details">Scraped ~480 public profiles. Aggregated 17 JSON sources.</div>
                <div class="tech-stack"><span class="tech-tag">JSONL</span><span class="tech-tag">Scraping</span></div>
            </div>

            <div class="node" id="n-norm">
                <div class="node-header">
                    <div class="node-icon">üßπ</div>
                    <div class="node-titles"><div class="node-title">Normalization & Std</div><div class="node-sub">Processing</div></div>
                </div>
                <div class="node-details">
                    ‚Ä¢ Diacritics Removal<br>
                    ‚Ä¢ Location Standardization<br>
                    ‚Ä¢ Schema Unification
                </div>
                <div class="tech-stack"><span class="tech-tag">Python Script</span></div>
            </div>

            <div class="node" id="n-enrichment">
                <div class="node-header">
                    <div class="node-icon">‚ú®</div>
                    <div class="node-titles"><div class="node-title">Enrichment</div><div class="node-sub">Visual AI</div></div>
                </div>
                <div class="node-details">
                    ‚Ä¢ <code>minimum_estimated_years_of_exp</code> calculated.<br>
                    ‚Ä¢ Images analyzed by <strong>GPT-5.2 Vision</strong>.
                </div>
                <div class="tech-stack"><span class="tech-tag">GPT-5.2</span><span class="tech-tag">Metadata</span></div>
            </div>

            <div class="node pulse" id="n-user">
                <div class="group-label">Frontend</div>
                <div class="node-header">
                    <div class="node-icon">üë§</div>
                    <div class="node-titles"><div class="node-title">User Browser</div><div class="node-sub">Client</div></div>
                </div>
                <div class="node-details" style="font-family:monospace; font-size:10px; color:#2563eb; word-break: break-all;">
                    rag-demo.ionutbogdan.ro
                </div>
                <div class="tech-stack"><span class="tech-tag">HTTPS</span><span class="tech-tag">Fetch API</span></div>
            </div>

            <div class="node" id="n-github">
                <div class="group-label">CI/CD Pipeline</div>
                <div class="node-header">
                    <div class="node-icon">üêô</div>
                    <div class="node-titles"><div class="node-title">GitHub Actions</div><div class="node-sub">Automation</div></div>
                </div>
                <div class="node-details">Push -> Build -> Test -> Deploy.</div>
                <div class="tech-stack"><span class="tech-tag">GitHub Secrets</span><span class="tech-tag">Pytest</span></div>
            </div>

            <div class="node" id="n-alb">
                <div class="node-header">
                    <div class="node-icon">üõ°Ô∏è</div>
                    <div class="node-titles"><div class="node-title">AWS ALB</div><div class="node-sub">Load Balancer</div></div>
                </div>
                <div class="node-details">TLS Termination (ACM). Rules for HTTP/HTTPS.</div>
                <div class="tech-stack"><span class="tech-tag">Port 443</span><span class="tech-tag">WAF</span></div>
            </div>

            <div class="node" id="n-ecr">
                <div class="node-header">
                    <div class="node-icon">üì¶</div>
                    <div class="node-titles"><div class="node-title">AWS ECR</div><div class="node-sub">Registry</div></div>
                </div>
                <div class="node-details">Stores production Docker images.</div>
                <div class="tech-stack"><span class="tech-tag">my-bmw-demo</span><span class="tech-tag">SHA Tags</span></div>
            </div>

            <div class="node pulse" id="n-ecs">
                <div class="node-header">
                    <div class="node-icon" style="color:#2563eb; background:#eff6ff;">‚öôÔ∏è</div>
                    <div class="node-titles"><div class="node-title">AWS ECS Fargate</div><div class="node-sub">bmw-service</div></div>
                </div>
                <div class="node-details" style="font-size:12px; margin: 16px 0; line-height:1.6;">
                    ‚Ä¢ <strong>FastAPI</strong> (Python 3.11)<br>
                    ‚Ä¢ <strong>LangChain</strong> Orchestrator<br>
                    ‚Ä¢ Serverless (0.5 vCPU, 3GB)<br>
                    ‚Ä¢ Role: <code>ecsTaskExecutionRole</code><br>
                    ‚Ä¢ Task: <code>bmw-task:35</code>
                </div>
                <div class="tech-stack">
                    <span class="tech-tag">Uvicorn</span>
                    <span class="tech-tag">Auto-scale</span>
                    <span class="tech-tag">Docker</span>
                </div>
            </div>

            <div class="node" id="n-secrets">
                <div class="group-label">Security</div>
                <div class="node-header">
                    <div class="node-icon">üîí</div>
                    <div class="node-titles"><div class="node-title">Secrets Mgr</div><div class="node-sub">Config</div></div>
                </div>
                <div class="node-details">Dynamic injection of API keys. No hardcoded creds.</div>
                <div class="tech-stack"><span class="tech-tag">IAM Auth</span><span class="tech-tag">Zero Trust</span></div>
            </div>

            <div class="node" id="n-s3">
                <div class="group-label" style="top: auto; bottom: -25px;">Storage</div>
                <div class="node-header">
                    <div class="node-icon">üíæ</div>
                    <div class="node-titles"><div class="node-title">AWS S3</div><div class="node-sub">Assets</div></div>
                </div>
                <div class="node-details">Stores profile images and raw JSONL backup.</div>
                <div class="tech-stack"><span class="tech-tag">Profile Images</span><span class="tech-tag">Data Lake</span></div>
            </div>

            <div class="ai-stack">
                <div class="node pulse" id="n-pinecone">
                    <div class="group-label">Generative AI</div>
                    <div class="node-header">
                        <div class="node-icon">üå≤</div>
                        <div class="node-titles"><div class="node-title">Pinecone</div><div class="node-sub">Vector DB</div></div>
                    </div>
                    <div class="node-details">Serverless Index. Hybrid search with metadata.</div>
                    <div class="tech-stack"><span class="tech-tag">text-embedding-3-large</span></div>
                </div>

                <div class="node pulse" id="n-cohere">
                    <div class="node-header">
                        <div class="node-icon">üå™Ô∏è</div>
                        <div class="node-titles"><div class="node-title">Cohere</div><div class="node-sub">Reranker</div></div>
                    </div>
                    <div class="node-details">Precision re-scoring of top results.</div>
                    <div class="tech-stack"><span class="tech-tag">rerank-english-v3.0</span><span class="tech-tag">Top N: 8</span></div>
                </div>

                <div class="node pulse" id="n-llm">
                    <div class="node-header">
                        <div class="node-icon">üß†</div>
                        <div class="node-titles"><div class="node-title">LLM Provider</div><div class="node-sub">Reasoning</div></div>
                    </div>
                    <div class="node-details">Synthesis & candidate analysis.</div>
                    <div class="tech-stack">
                        <span class="tech-tag">GPT-4o mini</span>
                        <span class="tech-tag">Gemini 3 Flash</span>
                        <span class="tech-tag">Gemini 2.5</span>
                    </div>
                </div>
            </div>

        </div>
    </div>
  </div>

  <div class="zoom-controls">
      <button class="zoom-btn" onclick="zoomIn()">+</button>
      <button class="zoom-btn" onclick="zoomOut()">‚àí</button>
  </div>

  <script>
    const wrapper = document.getElementById('wrapper');
    const svg = document.getElementById('svgLayer');
    const viewport = document.getElementById('viewport');

    // --- STATE ---
    let currentScale = 1;
    // Initial centering logic:
    // The wrapper is 1800x1000, positioned at top:50%, left:50%.
    // To center it perfectly, we normally translate by -50% of its size (-900, -500).
    // ADJUSTMENT: Shifted X by -60px (to -960) to visually balance the diagram on load.
    let contentX = -960;
    let contentY = -500;

    let isDragging = false;
    let startX = 0;
    let startY = 0;

    // --- FIT & RENDER ---
    function fitToScreen() {
        const paddingX = 40;
        const paddingY = 80;

        const availableW = window.innerWidth - paddingX;
        const availableH = window.innerHeight - paddingY;

        const logicalW = 1800;
        const logicalH = 1000;

        const scaleW = availableW / logicalW;
        const scaleH = availableH / logicalH;

        // 95% Fit for impact + 0.1 boost for larger initial size
        currentScale = (Math.min(scaleW, scaleH) * 0.95) + 0.1;

        // Safety bounds
        if(currentScale > 1.8) currentScale = 1.8;
        if(currentScale < 0.3) currentScale = 0.3;

        // Reset to center (with visual adjustment)
        contentX = -960;
        contentY = -500;

        updateTransform();
    }

    function updateTransform() {
        wrapper.style.transform = `translate(${contentX}px, ${contentY}px) scale(${currentScale})`;
    }

    function zoomIn() {
        if(currentScale < 2.0) {
            currentScale += 0.1;
            updateTransform();
        }
    }

    function zoomOut() {
        if(currentScale > 0.3) {
            currentScale -= 0.1;
            updateTransform();
        }
    }

    // --- DRAG LOGIC (Coordinate-based) ---
    viewport.addEventListener('mousedown', (e) => {
        isDragging = true;
        startX = e.clientX;
        startY = e.clientY;
        viewport.style.cursor = 'grabbing';
    });

    window.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        e.preventDefault();

        const dx = e.clientX - startX;
        const dy = e.clientY - startY;

        // Update content position directly
        // We divide by scale so the drag feels 1:1 with mouse movement
        contentX += dx / currentScale;
        contentY += dy / currentScale;

        startX = e.clientX;
        startY = e.clientY;

        updateTransform();
    });

    window.addEventListener('mouseup', () => {
        isDragging = false;
        viewport.style.cursor = 'grab';
    });

    // --- CONNECTORS (Robust) ---
    function connect(id1, id2, type = 'flow', anchor = 'auto') {
        const el1 = document.getElementById(id1);
        const el2 = document.getElementById(id2);
        if(!el1 || !el2) return;

        // Use offset coordinates relative to the wrapper
        const x1 = el1.offsetLeft;
        const y1 = el1.offsetTop;
        const w1 = el1.offsetWidth;
        const h1 = el1.offsetHeight;

        const x2 = el2.offsetLeft;
        const y2 = el2.offsetTop;
        const w2 = el2.offsetWidth;
        const h2 = el2.offsetHeight;

        let startX = x1 + w1;
        let startY = y1 + h1 / 2;
        let endX = x2;
        let endY = y2 + h2 / 2;

        if (anchor === 'vertical') {
            startX = x1 + w1 / 2;
            startY = y1 + h1;
            endX = x2 + w2 / 2;
            endY = y2;
        } else if (anchor === 'ecs-fan-out') {
            startX = x1 + w1;
            if(y2 < y1) startY = y1 + h1 * 0.25;
            else if (y2 > y1 + h1) startY = y1 + h1 * 0.75;
            else startY = y1 + h1 * 0.5;
            endX = x2;
            endY = y2 + h2 / 2;
        }

        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        const dx = Math.abs(endX - startX);
        const dy = Math.abs(endY - startY);
        let d = "";

        if (anchor === 'vertical') {
             d = `M ${startX} ${startY} C ${startX} ${startY + dy * 0.5}, ${endX} ${endY - dy * 0.5}, ${endX} ${endY}`;
        } else {
             d = `M ${startX} ${startY} C ${startX + dx * 0.5} ${startY}, ${endX - dx * 0.5} ${endY}, ${endX} ${endY}`;
        }

        path.setAttribute("d", d);
        if(type === 'static') {
            path.setAttribute("class", "connection-line connection-dashed");
        } else {
            path.setAttribute("class", "connection-line");
            addPacket(d);
        }
        svg.appendChild(path);
    }

    function addPacket(pathData) {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("r", "3");
        circle.setAttribute("class", "packet");
        const animate = document.createElementNS("http://www.w3.org/2000/svg", "animateMotion");
        animate.setAttribute("dur", (1.5 + Math.random()) + "s");
        animate.setAttribute("repeatCount", "indefinite");
        animate.setAttribute("path", pathData);
        animate.setAttribute("begin", "-" + Math.random() + "s");
        circle.appendChild(animate);
        svg.appendChild(circle);
    }

    function draw() {
        svg.innerHTML = '';
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        defs.innerHTML = `<marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto"><path d="M0,0 L0,6 L9,3 z" fill="#cbd5e1" /></marker>`;
        svg.appendChild(defs);

        connect('n-ingestion', 'n-norm', 'static', 'vertical');
        connect('n-norm', 'n-enrichment', 'static', 'vertical');
        connect('n-enrichment', 'n-s3', 'static');

        connect('n-github', 'n-ecr', 'static');
        connect('n-ecr', 'n-ecs', 'static');

        connect('n-user', 'n-alb');
        connect('n-alb', 'n-ecs');

        connect('n-ecs', 'n-secrets', 'static');
        connect('n-ecs', 'n-s3', 'static');

        connect('n-ecs', 'n-pinecone', 'flow', 'ecs-fan-out');
        connect('n-ecs', 'n-cohere', 'flow', 'ecs-fan-out');
        connect('n-ecs', 'n-llm', 'flow', 'ecs-fan-out');
    }

    // Init
    window.addEventListener('load', () => {
        fitToScreen();
        // Delay draw to ensure font metrics are ready
        setTimeout(draw, 100);
    });

    let resizeTimer;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
            fitToScreen();
            draw(); // Safety redraw
        }, 100);
    });

  </script>
</body>
</html>
